# Migration `20200918090614-fix-orphan-sibling`

This migration has been generated by Adem Mohammed at 9/18/2020, 12:06:14 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `depOrph`.`orphan` DROP FOREIGN KEY `orphan_ibfk_6`

ALTER TABLE `depOrph`.`orphan` DROP COLUMN `siblingId`

ALTER TABLE `depOrph`.`sibling` ADD COLUMN `orphanId` int  

CREATE UNIQUE INDEX `orphan_educationId_unique` ON `depOrph`.`orphan`(`educationId`)

CREATE INDEX `orphanId` ON `depOrph`.`sibling`(`orphanId`)

ALTER TABLE `depOrph`.`sibling` ADD FOREIGN KEY (`orphanId`) REFERENCES `depOrph`.`orphan`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE `depOrph`.`_migration`
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200828114852-auto-increment-all-ids..20200918090614-fix-orphan-sibling
--- datamodel.dml
+++ datamodel.dml
@@ -1,223 +1,254 @@
-generator client {
-    provider = "prisma-client-js"
-}
-
-datasource db {
-    provider = "mysql"
-    url = "***"
-}
-
-model Address {
-    state    String @id
-    zone     String
-    district String
-    kebele   String
-    site     Site
-    @@map("address")
-}
-
-model Donor {
-    id                           Int              @id @default(autoincrement())
-    companyName                  String
-    typeOfsupport                String?
-    initialDonationAmount        Float?
-    initialReportPreparationDate DateTime?
-    finalReportPreparationDate   DateTime?
-    initialDataCollectionDate    DateTime?
-    finalDataCollectionDate      DateTime?
-    reportDueDate                DateTime?
-    groupsOfOrphans              GroupOfOrphans[]
-    @@map("donor")
-}
-
-model Education {
-    id               Int                       @id @default(autoincrement())
-    enrollmentStatus educationEnrollmentStatus
-    schoolName       String?
-    typeOfSchool     educationTypeOfSchool?
-    grade            String?
-    reason           String?
-    hobbies          String?
-    orphans          Orphan[]
-    @@map("education")
-}
-
-model Father {
-    id            Int      @id @default(autoincrement())
-    dateOfDeath   DateTime
-    causeOfDeath  String
-    job           String?
-    monthlyIncome Int
-    dateOfBirth   DateTime
-    orphans       Orphan[]
-    @@map("father")
-}
-
-model GroupOfOrphans {
-    id               Int          @id @default(autoincrement())
-    registrationDate DateTime
-    donorId          Int
-    socialWorkerId   Int
-    siteId           Int
-    donor            Donor        @relation(fields: [donorId], references: [id])
-    site             Site         @relation(fields: [siteId], references: [id])
-    socialworker     SocialWorker @relation(fields: [socialWorkerId], references: [id])
-    orphans          Orphan[]
-
-    @@index([donorId], name: "donorId")
-    @@index([siteId], name: "siteId")
-    @@index([socialWorkerId], name: "socialWorkerId")
-    @@map("groupoforphans")
-}
-
-model Guardian {
-    id               Int      @id @default(autoincrement())
-    firstName        String
-    middleName       String
-    lastName         String
-    gender           String
-    nationality      String
-    state            String
-    zone             String
-    district         String
-    kebele           String
-    relationToOrphan String
-    email            String
-    job              String?
-    age              Int
-    orphans          Orphan[]
-    @@map("guardian")
-}
-
-model Iga_property {
-    id              Int      @id @default(autoincrement())
-    ownershipStatus String
-    otherProperty   String?
-    orphans         Orphan[]
-    @@map("iga_property")
-}
-
-model Mother {
-    id             Int       @id @default(autoincrement())
-    firstName      String
-    middleName     String
-    lastName       String
-    dateOfBirth    DateTime
-    phoneNumber    Int
-    job            Int
-    maritalStatus  String
-    vitalStatus    String
-    monthlyExpense Float
-    motherjob      MotherJob @relation(fields: [job], references: [id])
-    orphans        Orphan[]
-
-    @@index([job], name: "job")
-    @@map("mother")
-}
-
-model MotherJob {
-    id              Int     @id @default(autoincrement())
-    currentJobTitle String?
-    monthlyIncome   Float?
-    mother          Mother
-    @@map("motherjob")
-}
-
-model Orphan {
-    id                        Int            @id @default(autoincrement())
-    firstName                 String
-    fatherName                String
-    grandFatherName           String
-    greatGrandFatherName      String
-    gender                    orphanGender
-    placeOfBirth              String
-    dateOfBirth               DateTime
-    numberOfSponserdSiblings  Int
-    physicalHealthStatus      String
-    psychologicalHealthStatus String
-    otherHealthIssues         String?
-    photoPortraitUrl          String
-    photoLongUrl              String
-    fatherId                  Int
-    motherId                  Int
-    guardianId                Int
-    groupId                   Int
-    siblingId                 Int
-    IGA_PropertyId            Int
-    educationId               Int
-    siblings                  Sibling[]
-    iga_property              Iga_property   @relation(fields: [IGA_PropertyId], references: [id])
-    education                 Education      @relation(fields: [educationId], references: [id])
-    father                    Father         @relation(fields: [fatherId], references: [id])
-    groupoforphans            GroupOfOrphans @relation(fields: [groupId], references: [id])
-    guardian                  Guardian       @relation(fields: [guardianId], references: [id])
-    mother                    Mother         @relation(fields: [motherId], references: [id])
-
-    @@index([IGA_PropertyId], name: "IGA_PropertyId")
-    @@index([educationId], name: "educationId")
-    @@index([fatherId], name: "fatherId")
-    @@index([groupId], name: "groupId")
-    @@index([guardianId], name: "guardianId")
-    @@index([motherId], name: "motherId")
-    @@map("orphan")
-}
-
-model Sibling {
-    id            Int     @id @default(autoincrement())
-    fullName      String
-    gender        String
-    age           Int
-    schoolGrade   String?
-    job           String?
-    maritalStatus String
-    orphanId      Int
-    orphan        Orphan  @relation(fields: [orphanId], references: [id])
-
-    @@index([orphanId], name: "orphanId")
-    @@map("sibling")
-}
-
-model Site {
-    id             Int              @id @default(autoincrement())
-    siteName       String
-    donationAmount Int
-    addressId      String
-    address        Address          @relation(fields: [addressId], references: [state])
-    groupoforphans GroupOfOrphans[]
-    socialworker   SocialWorker[]
-
-    @@index([addressId], name: "addressId")
-    @@map("site")
-}
-
-model SocialWorker {
-    id             Int              @id @default(autoincrement())
-    fullName       String
-    phoneNumber    Int
-    email          String
-    siteId         Int
-    site           Site             @relation(fields: [siteId], references: [id])
-    groupoforphans GroupOfOrphans[]
-
-    @@index([siteId], name: "siteId")
-    @@map("socialworker")
-}
-
-enum educationEnrollmentStatus {
-    enrolled
-    unenrolled
-    droppedout
-    @@map("education_enrollmentStatus")
-}
-
-enum educationTypeOfSchool {
-    private
-    public
-    @@map("education_typeOfSchool")
-}
-
-enum orphanGender {
-    M
-    F
-    @@map("orphan_gender")
-}
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+model Donor {
+  id                           Int              @default(autoincrement()) @id
+  companyName                  String
+  initialReportPreparationDate DateTime?
+  finalReportPreparationDate   DateTime?
+  initialDataCollectionDate    DateTime?
+  finalDataCollectionDate      DateTime?
+  reportDueDate                DateTime?
+  sponsoredgroup               SponsoredGroup[]
+  @@map("donor")
+}
+
+model Education {
+  id               Int                        @default(autoincrement()) @id
+  enrollmentStatus education_enrollmentStatus
+  schoolName       String?
+  typeOfSchool     education_typeOfSchool?
+  grade            String?
+  reason           String?
+  hobbies          String?
+  orphan           Orphan
+  @@map("education")
+}
+
+model EducationalSupport {
+  id      Int       @default(autoincrement()) @id
+  support Support[]
+  @@map("educationalsupport")
+}
+
+model Father {
+  id            Int      @default(autoincrement()) @id
+  dateOfDeath   DateTime
+  causeOfDeath  String
+  job           String?
+  monthlyIncome Int
+  dateOfBirth   DateTime
+  orphans        Orphan[]
+  @@map("father")
+}
+
+model FinancialSupport {
+  id      Int       @default(autoincrement()) @id
+  support Support[]
+  @@map("financialsupport")
+}
+
+model Guardian {
+  id               Int      @default(autoincrement()) @id
+  firstName        String
+  middleName       String
+  lastName         String
+  gender           String
+  nationality      String
+  state            String
+  zone             String
+  district         String
+  kebele           String
+  relationToOrphan String
+  email            String
+  job              String?
+  age              Int
+  orphans           Orphan[]
+  @@map("guardian")
+}
+
+model Iga_property {
+  id              Int      @default(autoincrement()) @id
+  ownershipStatus String
+  otherProperty   String?
+  orphan          Orphan[]
+  @@map("iga_property")
+}
+
+model Mother {
+  id             Int        @default(autoincrement()) @id
+  firstName      String
+  middleName     String
+  lastName       String
+  dateOfBirth    DateTime
+  phoneNumber    String
+  jobId          Int?
+  maritalStatus  String
+  vitalStatus    String
+  monthlyExpense Float
+  motherjob      MotherJob? @relation(fields: [jobId], references: [id])
+  orphans        Orphan[]
+
+  @@index([jobId], name: "jobId")
+  @@map("mother")
+}
+
+model MotherJob {
+  id              Int      @default(autoincrement()) @id
+  currentJobTitle String?
+  monthlyIncome   Float?
+  mother          Mother[]
+  @@map("motherjob")
+}
+
+model OfficialDocuments {
+  id                            Int      @default(autoincrement()) @id
+  photoPortraitUrl              String
+  photoLongUrl                  String
+  fatherDeathCertificateUrl     String
+  birthCertificateUrl           String
+  guardianIDCardUrl             String
+  guardianConfirmationLetterUrl String
+  orphan                        Orphan[]
+  @@map("officialdocuments")
+}
+
+model Orphan {
+  id                        Int                @default(autoincrement()) @id
+  firstName                 String
+  fatherName                String
+  grandFatherName           String
+  greatGrandFatherName      String
+  gender                    orphan_gender
+  placeOfBirth              String
+  dateOfBirth               DateTime
+  numberOfSponserdSiblings  Int
+  physicalHealthStatus      String
+  psychologicalHealthStatus String
+  otherHealthIssues         String
+  fatherId                  Int?
+  motherId                  Int?
+  guardianId                Int?
+  IGA_PropertyId            Int?
+  educationId               Int?
+  docsId                    Int?
+  regGroupId                Int?
+  sponsrGroupId             Int?
+  iga_property              Iga_property?      @relation(fields: [IGA_PropertyId], references: [id])
+  officialdocuments         OfficialDocuments? @relation(fields: [docsId], references: [id])
+  education                 Education?         @relation(fields: [educationId], references: [id])
+  father                    Father?            @relation(fields: [fatherId], references: [id])
+  guardian                  Guardian?          @relation(fields: [guardianId], references: [id])
+  mother                    Mother?            @relation(fields: [motherId], references: [id])
+  registeredgroup           RegisteredGroup?   @relation(fields: [regGroupId], references: [id])
+  siblings                  Sibling[]          
+  sponsoredgroup            SponsoredGroup?    @relation(fields: [sponsrGroupId], references: [id])
+
+  @@index([IGA_PropertyId], name: "IGA_PropertyId")
+  @@index([docsId], name: "docsId")
+  @@index([educationId], name: "educationId")
+  @@index([fatherId], name: "fatherId")
+  @@index([guardianId], name: "guardianId")
+  @@index([motherId], name: "motherId")
+  @@index([regGroupId], name: "regGroupId")
+  @@index([sponsrGroupId], name: "sponsrGroupId")
+  @@map("orphan")
+}
+
+model OtherSupport {
+  id      Int       @default(autoincrement()) @id
+  support Support[]
+  @@map("othersupport")
+}
+
+model RegisteredGroup {
+  id               Int      @default(autoincrement()) @id
+  registrationDate DateTime
+  siteName         String
+  state            String
+  zone             String
+  district         String
+  kebele           String
+  orphans          Orphan[]
+  @@map("registeredgroup")
+}
+
+model Sibling {
+  id            Int      @default(autoincrement()) @id
+  fullName      String
+  gender        String
+  age           Int
+  schoolGrade   String?
+  job           String?
+  maritalStatus String
+  orphanId      Int?
+  orphan        Orphan?  @relation(fields: [orphanId], references: [id])
+  
+  @@index([orphanId], name: "orphanId")
+  @@map("sibling")
+}
+
+model SocialWorker {
+  id             Int              @default(autoincrement()) @id
+  fullName       String
+  phoneNumber    String
+  email          String
+  sponsoredgroup SponsoredGroup[]
+  @@map("socialworker")
+}
+
+model SponsoredGroup {
+  id              Int           @default(autoincrement()) @id
+  sponsorshipDate DateTime
+  supportId       Int?
+  donorId         Int?
+  socialWorkerId  Int?
+  donor           Donor?        @relation(fields: [donorId], references: [id])
+  socialworkers   SocialWorker? @relation(fields: [socialWorkerId], references: [id])
+  support         Support?      @relation(fields: [supportId], references: [id])
+  orphan          Orphan[]
+
+  @@index([donorId], name: "donorId")
+  @@index([socialWorkerId], name: "socialWorkerId")
+  @@index([supportId], name: "supportId")
+  @@map("sponsoredgroup")
+}
+
+model Support {
+  id                 Int                 @default(autoincrement()) @id
+  status             String?
+  financialId        Int?
+  educationalId      Int?
+  otherId            Int?
+  educationalsupport EducationalSupport? @relation(fields: [educationalId], references: [id])
+  financialsupport   FinancialSupport?   @relation(fields: [financialId], references: [id])
+  othersupport       OtherSupport?       @relation(fields: [otherId], references: [id])
+  sponsoredgroup     SponsoredGroup[]
+
+  @@index([educationalId], name: "educationalId")
+  @@index([financialId], name: "financialId")
+  @@index([otherId], name: "otherId")
+  @@map("support")
+}
+
+enum education_enrollmentStatus {
+  enrolled
+  unenrolled
+  droppedout
+}
+
+enum education_typeOfSchool {
+  private
+  public
+}
+
+enum orphan_gender {
+  M
+  F
+}
```


